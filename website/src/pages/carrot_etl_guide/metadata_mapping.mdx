import { Callout } from "nextra/components";
import HighlightedText from '@/components/HighlightedText';


## Stage 3: Metadata Mapping


<div style={{ display: "flex", alignItems: "flex-start", justifyContent: "space-between", gap: "20px" }}>
  <div style={{ flex: "1" }}>

  ### Upload to Carrot Scan Report

  **Upload Scan Report**

  - Log into [Carrot](https://carrot.ac.uk):
  - Upload Scan Report:
    - Click **Scan Reports** Tab.
    - Click **New Scan Report Upload** option.
    - Choose **Data Partner** - from drop-down list. 
    - Choose **Dataset** - from drop-down list.
    - Choose **Visibility**: Public or Restricted
      - Public = All registered users of Carrot can view the scan report.
      - Restricted = Only defined/specific registered users of CARROT can view the scan report.

  - Define **Editors** (users allowed to edit the dataset)
  - Define **Viewers** (users allowed to view a ‘restricted’ dataset)
  - Create the **Scan Report Name**.
  - Choose **WhiteRabbit ScanReport** file location for upload.
  - Choose **Data Dictionary** file location for upload. 
  - Check all items entered are correct.
  - Click **‘Submit’** button to upload the Scan Report.
  </div>

  <div style={{ flex: "0.5", textAlign: "right", alignSelf: "flex-start", marginTop: "40px" }}>
    <figure style={{ display: "inline-block", textAlign: "center", margin: "0 auto" }}>
      <img 
        src="/docs/Carrot-SOP/14.png" 
        alt="Upload mapping in metadata mapping" 
        width="200"
        height="250"
        style={{ 
          maxWidth: "100%", 
          height: "auto", 
          border: "1px solid #ddd", 
          padding: "5px" 
        }} 
      />
      <figcaption style={{ marginTop: "8px", marginRight: "60px", fontStyle: "italic", color: "#666" }}>
        Figure 15: Upload Mapping
        in Metadata Mapping.
      </figcaption>
    </figure>
  </div>

</div>

<div style={{ display: "flex", flexDirection: "column", alignItems: "center", marginTop: "10px", marginRight: "10px" }}>
  <figure style={{ textAlign: "center", margin: "0 auto" }}>
    <img 
      src="/docs/Carrot-SOP/15.png" 
      alt="Example of CARROT software tool screens for New Scan Report Upload" 
      width="700" 
      style={{ display: "block", margin: "0 auto" }} 
    />
    <figcaption style={{ marginTop: "8px", fontStyle: "italic", color: "#666" }}>
      Figure 16: Example of CARROT Software Tool Screens for New Scan Report Upload.
    </figcaption>
  </figure>
</div>





<div style={{ display: "flex", alignItems: "flex-start", justifyContent: "space-between", gap: "20px" }}>
  <div style={{ flex: "1" }}>

  ### Check the Scan Report Upload

  While logged into the Carrot tool:
  - Click **Scan Reports**.
  - Select **Scan Reports** tab.
  - Check the progress of your Scan Report upload – it will show one of the following three (see diagram): 
    - <span style={{ color: "green", fontWeight: "bold" }}>Upload Complete</span>
    - <span style={{ color: "orange", fontWeight: "bold" }}>Upload In Progress</span>
    - <span style={{ color: "red", fontWeight: "bold" }}>Upload Failed</span>
  - Refresh the web browser to check on upload progress.
  </div>

  <div style={{ flex: "0.5", textAlign: "right", alignSelf: "flex-start", marginTop: "40px" }}>
    <figure style={{ display: "inline-block", textAlign: "center", margin: "0 auto" }}>
      <img 
        src="/docs/Carrot-SOP/16.png" 
        alt="Upload to CARROT in metadata mapping" 
        width="160"
        height="190"
        style={{ 
          maxWidth: "100%", 
          height: "auto", 
          border: "1px solid #ddd", 
          padding: "5px" 
        }} 
      />
      <figcaption style={{ marginTop: "8px",marginRight: "100px", fontStyle: "italic", color: "#666" }}>
        Figure 17: Upload to Carrot
        in Metadata Mapping.
      </figcaption>
    </figure>
  </div>

</div>

<div style={{ display: "flex", flexDirection: "column", alignItems: "center", marginTop: "20px", marginRight: "40px" }}>
  <figure style={{ textAlign: "center", margin: "0 auto" }}>
    <img 
      src="/docs/Carrot-SOP/17.png" 
      alt="Example of CARROT tool Scan Report Status page" 
      width="700" 
      style={{ display: "block", margin: "0 auto" }} 
    />
    <figcaption style={{ marginTop: "8px", fontStyle: "italic", color: "#666" }}>
      Figure 18: Example of Carrot Tool Scan Report Status Page
    </figcaption>
  </figure>
</div>



<div style={{ display: "flex", alignItems: "flex-start", justifyContent: "space-between", gap: "20px" }}>
  <div style={{ flex: "1" }}>

    ### Map Rules

    #### Choose Dataset

    - Log into [Carrot](https://carrot.ac.uk):
    - Click **Datasets** Tab.
    - Click on the <i>Dataset ID</i> or <i>Name</i>.
    - Click on the <i>Dataset ID</i>, <i>Data Partner</i> or <i>Name</i>.
    - You will then be presented with a list of metadata tables.

    - <HighlightedText>Before you map rules, you must set the Person ID and Date Event for each table<i>(see diagram below)</i>:</HighlightedText>
      - Click **‘Edit Table’**
      - Select **<i>Person ID</i>** to map to for the Table. 
      - Select **<i>Date Event</i>** to map to for the Table.  
      - Click **‘Update’** Table-Name.csv.

    - Now the system is ready to map rules!

    #### Enter Rules

    - Choose the required table & click.
    - You will then be shown the data attributes for that table.
    - There are two levels at which rules can be mapped to
    data attributes:

      **(a) For all values per data attribute:**

          - Enter the <u>OMOP Concept ID</u> in the box.
          - Press **‘ADD’**
          - This will then map the OMOP Concept ID to all of the values for that individual data attribute.

      **(b) For individual values per data attribute:**

          - Click on the data variable to enter the set of values.
          - Enter the <u>OMOP Concept ID</u> in the box for each individual value as needed.
          - Press **‘ADD’**

  </div>

  <div style={{ flex: "0.5", textAlign: "right", alignSelf: "flex-start", marginTop: "40px" }}>
    <figure style={{ display: "inline-block", textAlign: "center", margin: "0 auto" }}>
      <img 
        src="/docs/Carrot-SOP/18.png" 
        alt="Upload mapping rules in metadata mapping" 
        width="160"
        height="190"
        style={{ 
          maxWidth: "100%", 
          height: "auto", 
          border: "1px solid #ddd", 
          padding: "5px" 
        }} 
      />
      <figcaption style={{ marginTop: "8px", marginRight: "100px", fontStyle: "italic", color: "#666" }}>
        Figure 19: Upload Mapping Rules in
        Metadata Mapping.
      </figcaption>
    </figure>
  </div>

</div>

<div style={{ display: "flex", flexDirection: "column", alignItems: "center", marginTop: "10px", marginRight: "40px" }}>
  <figure style={{ textAlign: "center", margin: "0 auto" }}>
    <img 
      src="/docs/Carrot-SOP/19.png" 
      alt="Setting Person ID and Date Event for each Dataset Metadata Table" 
      width="700" 
      style={{ display: "block", margin: "0 auto" }} 
    />
    <figcaption style={{ marginTop: "8px", fontStyle: "italic", color: "#666" }}>
      Figure 20: Setting Person ID and Date Event for Each Dataset Metadata Table.
    </figcaption>
  </figure>
</div>



<div style={{ display: "flex", alignItems: "flex-start", justifyContent: "space-between", gap: "20px" }}>
  <div style={{ flex: "1" }}>

    ### Check Map Rules

    #### Choose Dataset

    - Log into [Carrot](https://carrot.ac.uk):
    - Click **Datasets** Tab.
    - Click on the <i>Dataset ID</i> or <i>Name</i>.
    - Click on the <i>Dataset ID</i>, <i>Data Partner</i> or <i>Name</i>.
    - Click on ‘RULES’ button.
    - There are the following options (see diagram below):
        - Download Mapping JSON 
        - View Map Diagram
        - Download Map Diagram 
        - Download Mapping CSV 
        - Show Summary View
        - Analyse Rules
    - Check your mapped ruleset using one of the above options.

    **Export Mapping Ruleset:**

    - Click ‘Download Mapping JSON’
    - The JSON file will then be exported from CARROT and downloaded to your system.

  </div>

  <div style={{ flex: "0.5", textAlign: "right", alignSelf: "flex-start", marginTop: "40px" }}>
    <figure style={{ display: "inline-block", textAlign: "center", margin: "0 auto" }}>
      <img 
        src="/docs/Carrot-SOP/20.png" 
        alt="Check mapping rules in metadata mapping" 
        width="200"
        height="250"
        style={{ 
          maxWidth: "100%", 
          height: "auto", 
          border: "1px solid #ddd", 
          padding: "5px" 
        }} 
      />
      <figcaption style={{ marginTop: "8px", marginRight: "70px", fontStyle: "italic", color: "#666" }}>
        Figure 21: Check Mapping Rules
        in Metadata Mapping.
      </figcaption>
    </figure>
  </div>

</div>


<div style={{ display: "flex", flexDirection: "column", alignItems: "center", marginTop: "10px", marginRight: "40px" }}>
  <figure style={{ textAlign: "center", margin: "0 auto" }}>
    <img 
      src="/docs/Carrot-SOP/21.png" 
      alt="Example of Dataset Mapping Rule options" 
      width="700" 
      style={{ display: "block", margin: "0 auto" }} 
    />
    <figcaption style={{ marginTop: "8px", fontStyle: "italic", color: "#666" }}>
      Figure 22: Example of Dataset Mapping Rule Options.
    </figcaption>
  </figure>
</div>

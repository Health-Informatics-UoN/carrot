import { Callout } from "nextra/components";
import { Steps } from "nextra/components";


# Running Carrot-Transform with Docker

Carrot-Transform is available as a Docker container image, which makes it easy to run without installing Python dependencies locally. The container includes test data, so you can get started quickly by only mounting an output directory.

<Steps>

### Pull the Container Image

The container image is published to GitHub Container Registry. Pull it with:

```bash
docker pull ghcr.io/health-informatics-uon/carrot/transform:edge
```

The tag `edge` is the latest version of the container image.

For a specific version, check available tags at the [container registry](https://github.com/Health-Informatics-UoN/carrot-transform/pkgs/container/carrot%2Ftransform).

### Understand Docker Command Flags

Before running the container, it's helpful to understand the Docker flags used:

- **`--rm`**: Automatically removes the container after it exits, keeping your system clean
- **`-v`**: Mounts a volume (directory) from your host machine into the container
  - Format: `-v <host-path>:<container-path>`
  - This allows the container to read from and write to files on your machine
- **`$(pwd)`**: Shell command that expands to your current working directory
  - Example: If you're in `/Users/John-Doe/Documents/carrot`, then `$(pwd)/output` becomes `/Users/John-Doe/Documents/carrot/output`

In the examples below, `-v $(pwd)/output:/app/output` mounts a local `output` directory (created in your current folder) to `/app/output` inside the container, allowing you to access the transformed files on your machine.
The container includes test data and example mapping rules, so you can run Transform immediately without providing input files.

#### Basic Example

This example runs the transform without mounting any volumes. Output files will be written inside the container and will be lost when the container exits:

```bash
docker run --rm \
  ghcr.io/health-informatics-uon/carrot/transform:edge \
  uv run -m carrottransform.cli.command run_v2 folder \
    --input-dir /app/carrottransform/examples/test/inputs \
    --rules-file /app/carrottransform/examples/test/rules/v2.json \
    --person-file /app/carrottransform/examples/test/inputs/Demographics.csv \
    --output-dir /app/output \
    --omop-version 5.4
```

After running the command, you will see the following output:

```
Building carrot-transform @ file:///app
Built carrot-transform @ file:///app
Uninstalled 1 package in 11ms
Installed 1 package in 2ms
2025-12-17 15:58:20,216 - carrottransform.tools.logger - INFO - Detected v2.json format, using direct v2 parser...
2025-12-17 15:58:20,216 - carrottransform.tools.logger - INFO - Loaded v2 mapping rules from: /app/carrottransform/examples/test/rules/v2.json in 0.00535 secs
2025-12-17 15:58:20,262 - carrottransform.tools.logger - INFO - person_id stats: total loaded 1000, reject count 0
2025-12-17 15:58:20,270 - carrottransform.tools.logger - INFO - Processing data...
2025-12-17 15:58:20,270 - carrottransform.tools.logger - INFO - Streaming input file: Symptoms.csv
2025-12-17 15:58:20,308 - carrottransform.tools.logger - INFO - Streaming input file: covid19_antibody.csv
2025-12-17 15:58:20,390 - carrottransform.tools.logger - INFO - Streaming input file: Demographics.csv
2025-12-17 15:58:20,501 - carrottransform.tools.logger - INFO - TARGET: condition_occurrence: output count 400
2025-12-17 15:58:20,501 - carrottransform.tools.logger - INFO - TARGET: measurement: output count 1000
2025-12-17 15:58:20,501 - carrottransform.tools.logger - INFO - TARGET: observation: output count 400
2025-12-17 15:58:20,501 - carrottransform.tools.logger - INFO - TARGET: person: output count 1000
2025-12-17 15:58:20,507 - carrottransform.tools.logger - INFO - V2 processing completed successfully in 0.29559 secs
```

#### Example With Volume Mount

Let us now run it with a volume mount so we can access the output files on our host machine:


```bash
docker run --rm -v $(pwd)/output:/app/build \
  ghcr.io/health-informatics-uon/carrot/transform:edge \
  uv run -m carrottransform.cli.command run_v2 folder \
    --input-dir /app/carrottransform/examples/test/inputs \
    --rules-file /app/carrottransform/examples/test/rules/v2.json \
    --person-file /app/carrottransform/examples/test/inputs/Demographics.csv \
    --output-dir /app/build \
    --omop-version 5.4
```

After running the command, you will see the following output:

```
Building carrot-transform @ file:///app
      Built carrot-transform @ file:///app
Uninstalled 1 package in 12ms
Installed 1 package in 10ms
2025-12-17 16:02:37,586 - carrottransform.tools.logger - INFO - Detected v2.json format, using direct v2 parser...
2025-12-17 16:02:37,586 - carrottransform.tools.logger - INFO - Loaded v2 mapping rules from: /app/carrottransform/examples/test/rules/v2.json in 0.00363 secs
2025-12-17 16:02:37,639 - carrottransform.tools.logger - INFO - person_id stats: total loaded 1000, reject count 0
2025-12-17 16:02:37,652 - carrottransform.tools.logger - INFO - Processing data...
2025-12-17 16:02:37,652 - carrottransform.tools.logger - INFO - Streaming input file: Symptoms.csv
2025-12-17 16:02:37,690 - carrottransform.tools.logger - INFO - Streaming input file: covid19_antibody.csv
2025-12-17 16:02:37,745 - carrottransform.tools.logger - INFO - Streaming input file: Demographics.csv
2025-12-17 16:02:37,853 - carrottransform.tools.logger - INFO - TARGET: condition_occurrence: output count 400
2025-12-17 16:02:37,853 - carrottransform.tools.logger - INFO - TARGET: measurement: output count 1000
2025-12-17 16:02:37,853 - carrottransform.tools.logger - INFO - TARGET: observation: output count 400
2025-12-17 16:02:37,853 - carrottransform.tools.logger - INFO - TARGET: person: output count 1000
2025-12-17 16:02:37,858 - carrottransform.tools.logger - INFO - V2 processing completed successfully in 0.27554 secs
```

You will now be able to see the output files in the `output` directory on your host machine.

<div style={{ textAlign: "center", marginTop: "24px", marginBottom: "32px" }}>
  <figure style={{ margin: "0" }}>
    <img 
      src="/docs/Transform Output.png" 
      alt="Transform Output Files" 
      width="100%"
      height="auto"
      style={{ 
        maxWidth: "800px", 
        border: "3px solid #007acc", 
        borderRadius: "16px",
        padding: "12px",
        boxShadow: "0 8px 16px rgba(0,0,0,0.15)",
        backgroundColor: "#ffffff"
      }} 
    />
    <figcaption style={{ 
      marginTop: "16px", 
      fontStyle: "italic", 
      color: "#333",
      fontSize: "16px",
      fontWeight: "600"
    }}>
      Figure: Generated Transform Output Files
    </figcaption>
  </figure>
</div>

<Callout type="info">
  **Note:** The first example doesn't mount any volumes, so output files will be written to `/app/build` inside the container and will be lost when the container exits. The second example adds `-v $(pwd)/output:/app/build` to mount the output directory, allowing you to access the transformed files in the `output` directory on your host machine.
</Callout>


At this point, you have successfully run the transform with Docker. You can now use the output files in the `output` directory on your host machine.
You can go ahead and customoze this to use your own files. To do this, edit the input and output directories in the command to point to your own files.

</Steps>


## Additional Resources

- [Quickstart Guide](/transform/quickstart) - For local installation and usage
- [Database Connection](/transform/db_connection) - For connecting to databases from the container
- [Expected Output](/transform/expected_output) - Understanding the transformation results

